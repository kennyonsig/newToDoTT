<div class="list">
  <div class="list__header" [class.immutable-class]="taskList.isImmutable">
    <div class="list__info">
      <div class="list__info-section list__info-section--left">

        @if (!taskList.isImmutable) {
          <button class="list__button list__button--icon" (click)="openListMenu()">
            <mat-icon>more_vert</mat-icon>
          </button>

          @if (isListMenuOpen) {
            <div class="list-menu" (clickOutside)="onClickedOutside()">
              <button class="list-menu__item" (click)="startUpdateTaskTitle()">
                Переименовать список
              </button>
              <button class="list-menu__item list-menu__item--danger" (click)="removeList(taskList.id)">
               Удалить список
              </button>
            </div>
          }
        }

        <button class="list__toggle" (click)="toggleList()">
          <mat-icon class="list__icon">{{ isExpanded ? 'expand_less' : 'expand_more' }}</mat-icon>
        </button>
        <div class="list__title-wrapper">
          @if (startUpdate) {
            <input class="list__title-input"
                   type="text"
                   [(ngModel)]="taskList.title"
                   (keyup.enter)="updateTaskTitle()"
                   (clickOutside)="onClickedOutside()"
                   appAutoFocus
            >
          } @else {
            <p class="list__title-text">{{ taskList.title }}</p>
            <p class="list__counter">{{ taskList.tasks.length }}</p>
          }
        </div>
      </div>

      <div class="list__actions">
        <button class="list__action"><mat-icon class="list__icon">settings</mat-icon></button>
        <button class="list__action"><mat-icon class="list__icon">filter_list</mat-icon></button>
        <button class="list__action"><mat-icon class="list__icon">import_export</mat-icon></button>
        @if (taskList.canCreateTask) {
          <button class="list__action" (click)="atCreate()"><mat-icon class="list__icon">add_box</mat-icon></button>
        }
      </div>
    </div>

    <div class="list__move">
      <button class="list__move-button"><mat-icon>keyboard_arrow_up</mat-icon></button>
      <button class="list__move-button"><mat-icon>keyboard_arrow_down</mat-icon></button>
    </div>
  </div>

  <div class="list__main">
    @if (isExpanded) {
      @for (task of taskList.tasks; track task.id) {
        <app-task-on-page
          [task]="task"
          [taskListId]="taskList.id"
        ></app-task-on-page>
      }

      @if (canCreateTask) {

        @if (createdTask) {
          <div class="task-title__container">
            <input class="task-title__input"
                   type="text"
                   [(ngModel)]="taskTitle"
                   (keyup.enter)="addTask()"
                   placeholder="Введите название задачи"
                   (clickOutside)="onClickedOutside()"
                   appAutoFocus
            >
          </div>
        } @else {
          <div class="task-title__container">
            <button class="list__create-button" (click)="atCreate()">+ создать задачу</button>
          </div>
        }
      }
    }
  </div>
</div>
